{% extends 'base.html' %}
{% load static %}
{% block content %}

    <br>
    <section class="h-100 gradient-custom-2">
        <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col col-lg-9 col-xl-7">

                <div class="card" id="profileCard">

                    <div class="rounded-top text-white d-flex flex-row" style="background-color: #000000; height:250px;">
                        <div class="ms-4 mt-5 d-flex flex-column" style="width: 150px;">
                            <br>
                            <img src="" class="avatarDisp" id="avatarDisp">
                        </div>

                        <div class="ms-3" style="margin-top: 110px;">
                          <h5 id="nameView"></h5>
                          <small id="emailView"></small>
                        </div>
                    </div>
                </div>

                <div class="container">
                    <br>
                    <h3>Products</h3>
                    <br>
                    <div class="row justify-content-center" id="prodContainer">

                    </div>
                </div>

            </div>
        </div>
    </section>

{% endblock %}
{% block extra_js %}

    <script>
        var pathname = window.location.pathname;
        var profileID = pathname.split('/')[3]

        $(document).ready(function(){

            //get profile info
            $.ajax({
                type: "GET",
                url: "users/profile/" + profileID +"/",
                success: function(data){
                    $("#nameView").append(data.first_name + " " + data.last_name);
                    $("#emailView").append(data.email);
                    if(data.email === "{{user.email}}"){
                        $("#profileCard").append("<a href='{% url 'users:update-profile-page' %}' class='btn btn-outline-dark' data-mdb-ripple-color='dark' style='z-index: 1;'>Edit profile</a>");
                    }

                    if(data.avatar !== null){
                        $("#avatarDisp").attr('src', data.avatar);
                    }
                    else{
                       $("#avatarDisp").attr('src', '{% get_media_prefix %}defaultAvatar.png');
                    }
                },
            })

            //get owned products
            let temp = ""
            $.ajax({
                type:"GET",
                url:"/list/",
                success: function(data){
                    $.each(data, function(i,product){
                        var prodOwner = product.owner.split('/')[0]
                        var ownerID = product.owner.split('/')[1]
                        
                        if(ownerID === profileID){
                            temp += "<div class='col-4'>"
                            temp += "<div class='card border-primary mb-3' style='max-width: 20rem;'>"
                            temp += "<div class='card-header'>" + prodOwner + "</div>"
                            temp += "<div class='card-body'>"
                            temp += "<h4 class='card-title'>" + product.product_name +"</h4>"
                            if(product.prod_pic){
                                temp += "<img src='" + product.prod_pic + "' class='img-fluid' id='prodPic'></img>"
                            }
                            else{
                                temp += "<img src='{% get_media_prefix %}defaultProdPic.png' id='prodPic'></img>"
                            }
                            
                            temp += "<a href='users/profile-page/" + ownerID + "/' class='card-link'>Product seller details</a>"

                            if(product.status === 1){
                                temp += "<p style='color:green;'><strong style='color:grey;'>Status: </strong>" + product.status_name + "</p>"
                            }
                            else if(product.status === 2){
                                temp += "<p style='color:red;'><strong style='color:grey;'>Status: </strong>" + product.status_name + "</p>"
                            }
                            temp += "<p><strong>Category: </strong>" + product.category_name + "</p>"

                            temp += "</div><div class='card-footer'>"
                            temp += "<a href='/product-view/" + product.id + "/' class='btn btn-outline-dark' data-mdb-ripple-color='dark' style='z-index: 1;'>Details</a></div></div></div>"
                        }
                        
                    })
                    $("#prodContainer").append(temp);
                }
            })
            
        })


    </script>

{% endblock %}